# 게스트 모드 제한사항 구현 가이드

## 개요
게스트 모드는 제한된 기능으로 게임을 체험할 수 있는 모드입니다. 정식 계정으로 업그레이드하면 모든 기능을 이용할 수 있습니다.

## 구현된 제한사항

### 1. 게임 플레이
- **게스트**: AI 매치와 연습 모드만 가능
- **정식 계정**: 모든 게임 모드 가능 (AI, 랜덤 매칭, 친구 매치, 토너먼트)

### 2. 랜덤 매칭
- **게스트**: 1일 3판 제한 (자정에 초기화)
- **정식 계정**: 무제한

### 3. IAP (코인 구매)
- **게스트**: 구매 불가
- **정식 계정**: 모든 패키지 구매 가능 (코인, 배틀패스, 특별 아이템)

### 4. 광고 보상
- **게스트**: 1일 5회 제한 (자정에 초기화)
- **정식 계정**: 무제한

### 5. 친구 & 랭킹
- **게스트**: 읽기 전용 (친구 목록, 랭킹 확인만 가능)
- **정식 계정**: 모든 기능 활성화 (친구 추가, DM, 초대, 랭킹 필터링)

### 6. 클라우드 백업
- **게스트**: 로컬 캐시만
- **정식 계정**: Supabase 클라우드 백업

### 7. 고객센터
- **게스트**: FAQ 읽기만 가능
- **정식 계정**: 모든 문의 기능 (이메일, 버그 신고, 기능 제안, 채팅 상담)

## 구현된 파일들

### 1. 게스트 제한 관리
- `lib/services/guest_restrictions.dart`: 게스트 모드 제한 로직 관리

### 2. 화면 구현
- `lib/screens/game_mode_selection_page.dart`: 게임 모드 선택 (제한 적용)
- `lib/screens/shop_page.dart`: 상점 (IAP 제한, 광고 보상)
- `lib/screens/social_page.dart`: 친구 & 랭킹 (읽기 전용)
- `lib/screens/customer_service_page.dart`: 고객센터 (FAQ만)
- `lib/screens/home_page.dart`: 홈 화면 (새로운 메뉴 구조)

## 주요 기능

### GuestRestrictions 클래스
```dart
// 게임 모드 제한 확인
bool canPlayGameMode(String gameMode, bool isGuest)

// 랜덤 매칭 제한 확인
Future<bool> canPlayRandomMatch(bool isGuest)

// 광고 보상 제한 확인
Future<bool> canWatchAdReward(bool isGuest)

// IAP 구매 가능 여부
bool canPurchaseIAP(bool isGuest)

// 친구 기능 제한 확인
bool canUseFriendFeatures(String feature, bool isGuest)

// 고객센터 기능 제한 확인
bool canUseCustomerService(String feature, bool isGuest)
```

### 일일 제한 관리
- SharedPreferences를 사용하여 일일 사용량 추적
- 자정에 자동으로 카운터 초기화
- 랜덤 매칭과 광고 보상 횟수 관리

### 업그레이드 안내
- 제한된 기능 사용 시 업그레이드 다이얼로그 표시
- 계정 만들기 버튼으로 로그인 화면 이동

## UI/UX 특징

### 1. 시각적 구분
- 게스트 모드: 회색/잠금 아이콘으로 비활성화 표시
- 정식 계정: 컬러풀한 아이콘과 활성화 상태

### 2. 안내 메시지
- 각 화면 상단에 게스트 모드 제한사항 안내
- 구체적인 제한 내용과 업그레이드 방법 설명

### 3. 실시간 상태 표시
- 남은 랜덤 매칭 횟수 표시
- 남은 광고 보상 횟수 표시
- 무제한 사용자와 구분된 표시

## 데이터 저장

### 로컬 저장소 (SharedPreferences)
```dart
// 키 이름
'last_reset_date'        // 마지막 초기화 날짜
'random_matches_today'   // 오늘 사용한 랜덤 매칭 횟수
'ad_rewards_today'       // 오늘 사용한 광고 보상 횟수
```

### 초기화 로직
```dart
Future<void> _checkDailyReset() async {
  final today = DateTime.now().toIso8601String().split('T')[0];
  if (lastResetDate != today) {
    // 카운터 초기화
  }
}
```

## 보안 고려사항

### 1. 클라이언트 사이드 제한
- 현재는 클라이언트에서만 제한을 확인
- 서버 사이드 검증 추가 권장

### 2. 데이터 무결성
- SharedPreferences는 사용자가 수정 가능
- 서버에서 최종 검증 필요

### 3. 업그레이드 경로
- 게스트 → 정식 계정 전환 시 데이터 마이그레이션
- 기존 게임 기록 보존

## 향후 개선사항

### 1. 서버 사이드 검증
- 모든 제한사항을 서버에서 재검증
- 클라이언트 조작 방지

### 2. 분석 및 모니터링
- 게스트 모드 사용 패턴 분석
- 업그레이드 전환율 추적

### 3. 개인화된 제한
- 사용자별 맞춤 제한 설정
- A/B 테스트를 통한 최적화

### 4. 오프라인 지원
- 네트워크 없이도 기본 제한 적용
- 동기화 시 서버와 클라이언트 데이터 병합

## 테스트 시나리오

### 1. 게스트 모드 테스트
- [ ] AI 매치만 접근 가능
- [ ] 랜덤 매칭 3판 후 제한 확인
- [ ] 광고 보상 5회 후 제한 확인
- [ ] IAP 구매 시도 시 제한 확인
- [ ] 친구 기능 사용 시 제한 확인
- [ ] 고객센터 문의 시 제한 확인

### 2. 정식 계정 테스트
- [ ] 모든 게임 모드 접근 가능
- [ ] 랜덤 매칭 무제한 사용
- [ ] 광고 보상 무제한 사용
- [ ] IAP 구매 가능
- [ ] 모든 친구 기능 사용 가능
- [ ] 모든 고객센터 기능 사용 가능

### 3. 업그레이드 테스트
- [ ] 게스트 → 정식 계정 전환
- [ ] 기존 데이터 보존 확인
- [ ] 제한 해제 확인

## 결론

게스트 모드 제한사항이 성공적으로 구현되었습니다. 사용자는 제한된 기능으로 게임을 체험할 수 있으며, 정식 계정으로 업그레이드하면 모든 기능을 이용할 수 있습니다. 

각 화면에서 명확한 안내와 함께 업그레이드 경로를 제공하여 사용자 경험을 최적화했습니다. 